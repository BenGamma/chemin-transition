var app;app=angular.module("app",["ui.router","leaflet-directive","ipCookie","mm.foundation"]),app.config(["$stateProvider","$urlRouterProvider",function(e,r){return r.otherwise(function(e){var r;return r=e.get("$state"),r.go("index")}),e.state("index",{url:"/",views:{"":{templateUrl:"partials/map.html",controller:"mapController"},sidebar:{templateUrl:"partials/sidebar.html",controller:"sideBarController"}},onEnter:["authService",function(e){return e.needsLogin?e.showLogin():void 0}]}).state("users",{url:"/users",resolve:{check:["$state","authService",function(e,r){return r.isAuthorize()}]}}).state("users.profile",{url:"/profile"})}]),app.factory("appConfig",function(){var e;return e="http://localhost:3000/api",{url:function(r){return""+e+"/"+r}}}),app.service("authService",["ipCookie","userData","$state","$modal",function(e,r,t,n){return{user:{},token:null,needsLogin:!1,isAuthorize:function(){return e("token")||e("mail")?void 0:(this.needsLogin=!0,t.go("index"))},showLogin:function(){return this.login=n.open({templateUrl:"partials/login.html",controller:"loginController"}),this.login.result.then(function(e){return $scope.selected=e})},hideLogin:function(){return this.login.dismiss("cancel")},showRegister:function(){return this.register=n.open({templateUrl:"partials/register.html",controller:"registerController"}),this.register.result.then(function(e){return $scope.selected=e})},hideRegister:function(){return this.register.dismiss("cancel")}}}]),app.controller("loginController",["$scope","$modalInstance","authService","userData",function(e,r,t,n){return e.cancel=function(){return t.hideLogin()},e.login=function(e,r){return n.login(r).then(function(){},function(e){return r.error=e.message})}}]),app.controller("mapController",["$scope","leafletData","$modal","authService",function(e,r,t,n){return e.open=function(){return n.showLogin()}}]),app.directive("map",["leafletData",function(){return{restrict:"E",link:function(){var e,r,t,n;return r=L.map("map",{center:"center"}).setView([48.8375,2.3291],13),t='<a href="http://openstreetmap.org">OpenStreetMap</a>',L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; "+t+" Contributors",minZoom:10}).addTo(r),e=function(e){var r,t,n,o,i;return r=e.getBounds(),i=r.getSouthWest(),o=r.getNorthEast(),n=o.lng-i.lng,t=o.lat-i.lat,new L.LatLng(i.lat+t*Math.random(),i.lng+n*Math.random())},n=new L.MarkerClusterGroup,n.initialize,n.addLayer(new L.Marker(e(r))),n.addLayer(new L.Marker(e(r))),n.addLayer(new L.Marker(e(r))),r.addLayer(n),r.on("click",function(e){var t;t=L.marker(e.latlng),markersList.push({latlng:e.latlng}),t.addTo(r)})}}}]),app.controller("registerController",["$scope","$modalInstance","authService","userData",function(e,r,t,n){return e.cancel=function(){return t.hideRegister()},e.login=function(e,r){return n.register(r).then(function(){},function(e){return r.error=e.message})}}]),app.controller("sideBarController",["$scope","leafletData","$modal","authService",function(e,r,t,n){return e.openLogin=function(){return n.showLogin()},e.openRegister=function(){return n.showRegister()}}]),app.controller("sideBareController",["$scope","leafletData","$modal","authService",function(e,r,t,n){return e.open=function(){return n.showLogin()}}]),app.factory("userData",["$http","$q","appConfig","ipCookie",function(e,r,t,n){return{login:function(n){var o;return o=r.defer(),e({method:"POST",url:t.url("sessions/login"),data:n}).success(function(e,r){return o.resolve(r)}).error(function(e){return o.reject(e)}),o.promise},checkUser:function(){var o;return o=r.defer(),e({method:"GET",url:t.url("sessions"),headers:{token:n("token"),mail:n("mail")}}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},create:function(n){var o;return o=r.defer(),e({method:"POST",url:t.url("users"),data:n}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},update:function(n){var o;return o=r.defer(),e({method:"PUT",url:t.url("users"),params:{id:n._id},data:n}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},"delete":function(){var n;return n=r.defer(),e({method:"DELETE",url:t.url("users"),params:{id:user._id},data:user}).success(function(e,r){return n.resolve(r)}).error(function(e,r){return n.reject(r)}),n.promise}}}]);