var app;app=angular.module("app",["ui.router","leaflet-directive","ipCookie"]),app.config(["$stateProvider","$urlRouterProvider",function(e,r){return r.otherwise(function(e){var r;return r=e.get("$state"),r.go("map")}),e.state("map",{url:"/",templateUrl:"partials/map.html",controller:"mapController"}).state("users",{url:"/users",resolve:{check:["$state","authService",function(e,r){return r.isAuthorize()?void 0:(r.needsLogin=!0,e.go("map"))}]}}).state("users.profile",{url:"/profile"})}]),app.factory("appConfig",function(){var e;return e="http://localhost:3000",{url:function(r){return e+"/"+r}}}),app.service("authService",["ipCookie","userData",function(e,r){return{user:{},token:null,isAuthorize:function(){return!e(token)||!e(mail),r.checkUser().then(function(e){return console.log(e)})}}}]),app.controller("loginController",["$scope",function(){}]),app.controller("mapController",["$scope","leafletData",function(){}]),app.directive("map",["leafletData",function(){return{restrict:"E",link:function(){var e,r,t,n,o;return L.mapbox.accessToken="pk.eyJ1IjoidG9ueWx1Y2FzIiwiYSI6IlRqa09UbE0ifQ.DGFIsGazdBZSk0t2PYe6Zw",t=L.tileLayer("https://{s}.tiles.mapbox.com/v4/examples.map-i87786ca/{z}/{x}/{y}.png?access_token="+L.mapbox.accessToken,{attribution:'<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'}),r=L.map("map").addLayer(t).locate({setView:!0,maxZoom:16}),e=function(e){var r,t,n,o,a;return r=e.getBounds(),a=r.getSouthWest(),o=r.getNorthEast(),n=o.lng-a.lng,t=o.lat-a.lat,new L.LatLng(a.lat+t*Math.random(),a.lng+n*Math.random())},o=function(){var t,n,o;for(n=new L.MarkerClusterGroup,t=o=0;150>=o;t=++o)n.addLayer(new L.Marker(e(r)));return r.addLayer(n)},n=function(e){return alert(e.message)},r.on("locationfound",o),r.on("locationerror",n)}}}]),app.factory("userData",["$http","$q","appConfig","ipCookie",function(e,r,t,n){return{login:function(n){var o;return o=r.defer(),e({method:"POST",url:t.url("sessions/login"),data:n}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},checkUser:function(){var o;return o=r.defer(),e({method:"GET",url:t.url("sessions"),headers:{token:n("token"),mail:n("mail")}}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},create:function(n){var o;return o=r.defer(),e({method:"POST",url:t.url("users"),data:n}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},update:function(n){var o;return o=r.defer(),e({method:"PUT",url:t.url("users"),params:{id:n._id},data:n}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},"delete":function(){var n;return n=r.defer(),e({method:"DELETE",url:t.url("users"),params:{id:user._id},data:user}).success(function(e,r){return n.resolve(r)}).error(function(e,r){return n.reject(r)}),n.promise}}}]);