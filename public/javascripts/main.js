var app;app=angular.module("app",["ui.router","leaflet-directive","ipCookie","mm.foundation"]),app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,r,t){return r.otherwise(function(e){var r;return r=e.get("$state"),r.go("index")}),t.html5Mode(!0),e.state("index",{url:"/",views:{"":{templateUrl:"partials/map.html",controller:"mapController"},navbar:{templateUrl:"partials/navbar.html",controller:"navBarController"}},onEnter:["authService",function(e){return e.needsLogin?e.showLogin():void 0}]}).state("users",{url:"/users",resolve:{check:["$state","authService",function(e,r){return r.isAuthorize()}]}}).state("users.profile",{url:"/profile"}).state("structures",{url:"/structures",templateUrl:"partials/structures.html",controller:"structuresController"}).state("skills",{url:"/skills",templateUrl:"partials/skills.html",controller:"skillsController"}).state("assets",{url:"/assets",templateUrl:"partials/assets.html",controller:"assetsController"})}]),app.factory("appConfig",function(){var e;return e="http://localhost:3000/api",{url:function(r){return""+e+"/"+r}}}),app.controller("assetsController",["$scope","leafletData",function(){}]),app.service("authService",["ipCookie","userData","$state","$modal",function(e,r,t,n){return{user:{},token:null,needsLogin:!1,setSession:function(r){return this.user=r,this.token=r.token,e("token",this.token),e("email",this.user.email)},isAuthorize:function(){return e("token")||e("mail")?r.checkUser().then(function(e){return 204!==e?t.go("index"):void 0}):(this.needsLogin=!0,t.go("index"))},showLogin:function(){return this.login=n.open({templateUrl:"partials/login.html",controller:"loginController"}),this.login.result.then(function(e){return $scope.selected=e})},hideLogin:function(){return this.login.dismiss("cancel")},showRegister:function(){return this.register=n.open({templateUrl:"partials/register.html",controller:"registerController"}),this.register.result.then(function(e){return $scope.selected=e})},hideRegister:function(){return this.register.dismiss("cancel")}}}]),app.controller("loginController",["$scope","$modalInstance","authService","userData",function(e,r,t,n){return e.cancel=function(){return t.hideLogin()},e.login=function(e,r){return e.$invalid?void 0:n.login(r).then(function(e){return t.setSession(e)},function(e){return r.error=e})}}]),app.controller("mapController",["$scope","leafletData","$modal","authService",function(e,r,t,n){return e.open=function(){return n.showLogin()}}]),app.directive("map",["leafletData",function(){return{restrict:"E",link:function(){var e,r,t,n,o;return L.mapbox.accessToken="pk.eyJ1IjoidG9ueWx1Y2FzIiwiYSI6IlRqa09UbE0ifQ.DGFIsGazdBZSk0t2PYe6Zw",t=L.tileLayer("https://{s}.tiles.mapbox.com/v4/examples.map-i87786ca/{z}/{x}/{y}.png?access_token="+L.mapbox.accessToken,{attribution:'<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'}),r=L.map("map").addLayer(t).setView([51.505,-.09],13),e=function(e){var r,t,n,o,i;return r=e.getBounds(),i=r.getSouthWest(),o=r.getNorthEast(),n=o.lng-i.lng,t=o.lat-i.lat,new L.LatLng(i.lat+t*Math.random(),i.lng+n*Math.random())},o=function(){var t,n,o;for(n=new L.MarkerClusterGroup,t=o=0;300>=o;t=++o)n.addLayer(new L.Marker(e(r)));return r.addLayer(n)},n=function(e){return alert(e.message)},r.on("locationfound",o),r.on("locationerror",n)}}}]),app.controller("navBarController",["$scope","leafletData","$modal","authService",function(e,r,t,n){return $(document).foundation(),e.openLogin=function(){return n.showLogin()},e.openRegister=function(){return n.showRegister()}}]),app.controller("registerController",["$scope","$modalInstance","authService","userData",function(e,r,t,n){return e.cancel=function(){return t.hideRegister()},e.register=function(e,r){return console.log(r),e.$invalid?void 0:n.create(r).then(function(){return t.hideRegister()},function(){return r.error="email Already use"})}}]),app.controller("sideBarController",["$scope","leafletData","$modal","authService",function(e,r,t,n){return e.openLogin=function(){return n.showLogin()},e.openRegister=function(){return n.showRegister()}}]),app.controller("skillsController",["$scope","leafletData",function(){}]),app.controller("structuresController",["$scope","leafletData",function(){}]),app.factory("userData",["$http","$q","appConfig","ipCookie",function(e,r,t,n){return{login:function(n){var o;return o=r.defer(),e({method:"POST",url:t.url("sessions/login"),data:n}).success(function(e){return o.resolve(e)}).error(function(e){return o.reject(e)}),o.promise},checkUser:function(){var o;return o=r.defer(),e({method:"GET",url:t.url("sessions"),headers:{"X-token":n("token"),"X-email":n("email")}}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},create:function(n){var o;return o=r.defer(),e({method:"POST",url:t.url("users"),data:n}).success(function(e,r){return o.resolve(r)}).error(function(e,r){return o.reject(r)}),o.promise},update:function(o){var i;return i=r.defer(),e({method:"PUT",url:t.url("users"),params:{id:o._id},data:o,headers:{token:n("token"),email:n("email")}}).success(function(e,r){return i.resolve(r)}).error(function(e,r){return i.reject(r)}),i.promise},"delete":function(){var n;return n=r.defer(),e({method:"DELETE",url:t.url("users"),params:{id:user._id},data:user}).success(function(e,r){return n.resolve(r)}).error(function(e,r){return n.reject(r)}),n.promise}}}]);